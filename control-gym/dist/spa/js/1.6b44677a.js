(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{1242:function(e,t,a){"use strict";a("e6cf");const i=async e=>fetch(e).then((e=>e.blob())).then((e=>new Promise(((t,a)=>{const i=new FileReader;i.onloadend=()=>t(i.result),i.onerror=a,i.readAsDataURL(e)}))));t["a"]=i},"1e2d":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"row"},[a("div",{staticClass:"float-left q-ml-md col-1"},[a("q-btn",{attrs:{icon:"keyboard_backspace",to:"/usuarios",round:"",flat:"",color:"white"}})],1),a("div",{staticClass:"col",attrs:{align:"center"}},[a("q-card",{staticClass:"card q-ma-md ",staticStyle:{width:"80%"}},[a("div",{staticClass:"tex-white text-center text-weight-bolder text-h3 q-mt-xs"},[e._v("\n        Nuevo Usuario\n      ")]),a("q-card-section",[a("div",[a("select-picture",{staticClass:"col-3",on:{null:e.clearImg},model:{value:e.picture,callback:function(t){e.picture=t},expression:"picture"}})],1),a("div",{staticClass:"row q-gutter-md justify-center"},[a("div",{staticClass:"col-md-3 col-xs-12"},[a("q-input",{ref:"first_name",attrs:{dark:"",rules:[function(e){return!!e||"campo requerido"}],color:"white",label:"Nombres"},model:{value:e.form.first_name,callback:function(t){e.$set(e.form,"first_name",t)},expression:"form.first_name"}})],1),a("div",{staticClass:"col-md-3 col-xs-12"},[a("q-input",{ref:"last_name",attrs:{dark:"",rules:[function(e){return!!e||"campo requerido"}],color:"white",label:"Apellidos"},model:{value:e.form.last_name,callback:function(t){e.$set(e.form,"last_name",t)},expression:"form.last_name"}})],1),a("div",{staticClass:"col-md-3 col-xs-12"},[a("q-input",{ref:"identity_card",attrs:{dark:"",rules:[function(e){return!!e||"campo requerido"}],color:"white",type:"number",label:"Cedula de identidad"},model:{value:e.form.identity_card,callback:function(t){e.$set(e.form,"identity_card",t)},expression:"form.identity_card"}})],1),a("div",{staticClass:"row col-md-3 col-xs-12"},[a("q-input",{ref:"entry_date",attrs:{dark:"",rules:[function(e){return!!e||"campo requerido"}],color:"white",label:"Fecha de entrada"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{attrs:{cover:"","transition-show":"scale","transition-hide":"scale"}},[a("q-date",{staticClass:"dialog ",attrs:{color:"grey-8",minimal:"",mask:"YYYY-MM-DD"},model:{value:e.form.entry_date,callback:function(t){e.$set(e.form,"entry_date",t)},expression:"form.entry_date"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Cerrar",color:"white",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:e.form.entry_date,callback:function(t){e.$set(e.form,"entry_date",t)},expression:"form.entry_date"}})],1),a("div",{staticClass:"col-md-3 col-xs-12"},[a("q-input",{ref:"email",attrs:{dark:"",rules:[function(e){return!!e||"campo requerido"}],color:"white",label:"Correo",type:"email"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),a("div",{staticClass:"col-md-3 col-xs-12"},[a("q-input",{ref:"phone",attrs:{dark:"",rules:[function(e){return!!e||"campo requerido"}],color:"white",label:"Número de telefono",mask:"(####) ### - ####","unmasked-value":""},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),a("div",{staticClass:"col-md-3 col-xs-12"},[a("q-select",{ref:"sex",attrs:{rules:[function(e){return!!e||"campo requerido"}],options:[{label:"Masculino",value:"m"},{label:"Femenino",value:"f"}],dark:"",color:"white",label:"Sexo","map-options":"","emit-value":""},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}})],1),a("div",{staticClass:"col-md-3 col-xs-12"},[a("q-select",{ref:"payment_type",attrs:{rules:[function(e){return!!e||"campo requerido"}],options:[{label:"Mensual",value:"mes"},{label:"Semanal",value:"semana"}],dark:"",color:"white",label:"Tipo de pago","map-options":"","emit-value":""},model:{value:e.form.payment_type,callback:function(t){e.$set(e.form,"payment_type",t)},expression:"form.payment_type"}})],1),a("div",{staticClass:" col-md-3 col-xs-12"},[a("q-btn",{staticClass:"q-mt-md",attrs:{label:"Cargar archivo",color:"white",outline:""},on:{click:function(t){e.dialog_archivo=!0}}})],1)])]),a("q-card-section",{attrs:{align:"center"}},[a("q-btn",{staticStyle:{width:"200px"},attrs:{id:"btn",loading:e.loading},on:{click:function(t){return e.save()}}},[a("div",{staticClass:"text-center text-weight-bolder"},[e._v("\n            Guardar\n          ")])])],1)],1)],1),a("q-dialog",{model:{value:e.dialog_archivo,callback:function(t){e.dialog_archivo=t},expression:"dialog_archivo"}},[a("q-card",{staticClass:"dialog",staticStyle:{width:"300px"}},[a("q-card-section",{attrs:{align:"center"}},[a("select-picture",{staticClass:"col-3",on:{null:e.clearImg},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}}),a("div",{staticClass:"q-mt-md"},[a("q-btn-group",{attrs:{push:""}},[a("q-btn",{attrs:{outline:"",label:"cancelar",color:"white"},on:{click:function(t){e.file=null,e.dialog_archivo=!1}}})],1)],1)],1)],1)],1)],1)},s=[],o=(a("e6cf"),a("ded3")),r=a.n(o),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"relative-position"},[a("picture-input",{ref:"picture",staticClass:"relative-position picture",style:{opacity:e.model?0:1,zIndex:2},attrs:{width:e.isPersonalFile?"200":"1500",height:e.isPersonalFile?"200":"1000",margin:"16",crop:!1,hideChangeButton:!0,removable:!0,removeButtonClass:"bg-red no-border text-white",accept:"image/jpeg,image/png",size:"0.24","custom-strings":{upload:"<h1>Bummer!</h1>",drag:"Arrastra una imagen o seleccionala",remove:"Eliminar la foto"}},on:{change:e.onChange}}),e.model?a("div",{staticClass:"absolute-top-right fit",staticStyle:{"background-position":"center","background-repeat":"no-repeat","background-size":"contain","z-index":"1"},style:{backgroundImage:"url("+e.model+")"}}):e._e(),e.model?a("q-btn",{staticClass:"text-white absolute-top-right q-ma-none",staticStyle:{"z-index":"100"},attrs:{icon:"create",flat:"",round:"",color:"primary"},on:{click:function(t){e.editar=!0}}}):e._e(),e.model?a("q-btn",{staticClass:"text-white absolute-top-right q-mt-xl q-mx-none q-mb-none",staticStyle:{"z-index":"100"},attrs:{icon:"delete",flat:"",round:"",color:"primary"},on:{click:function(t){return e.deleteImg()}}}):e._e(),a("q-dialog",{attrs:{maximized:""},model:{value:e.editar,callback:function(t){e.editar=t},expression:"editar"}},[a("q-card",{staticStyle:{width:"100%"}},[a("q-toolbar",{staticClass:" text-white",staticStyle:{background:"linear-gradient(0.25turn, #0a111b, #2e2f34)"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"keyboard_arrow_left"}}),a("q-toolbar-title",[e._v("\n          Editar imagen\n        ")]),a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"check"},on:{click:e.crop}})],1),e.model&&e.editar?a("vue-cropper",{ref:"cropper",staticClass:"fit",attrs:{src:e.model,alt:"Source Image"},on:{cropmove:e.cropImage}}):e._e()],1)],1)],1)},n=[],c=a("95c3"),d=a.n(c),u=a("e597"),m={components:{VueCropper:d.a,PictureInput:u["a"]},props:{value:{}},data(){return{editar:!1,path:null,isPersonalFile:!0,isRemoved:!1}},computed:{model:{get(){return this.value},set(e){this.$emit("input",e)}}},methods:{onChange(e){this.model=e},cropImage(e){},crop(){this.editar=!1,this.model=this.$refs.cropper.getCroppedCanvas().toDataURL()},deleteImg(){this.onChange(null)}},mounted(){this.$route.path}},h=m,f=(a("adb8"),a("2877")),p=a("9c40"),v=a("24e8"),g=a("f09f"),b=a("65c6"),y=a("6ac5"),q=a("7f67"),$=a("eebe"),_=a.n($),x=Object(f["a"])(h,l,n,!1,null,null,null),w=x.exports;_()(x,"components",{QBtn:p["a"],QDialog:v["a"],QCard:g["a"],QToolbar:b["a"],QToolbarTitle:y["a"]}),_()(x,"directives",{ClosePopup:q["a"]});var C=a("1242"),k={components:{SelectPicture:w},data(){return{form:{},loading:!1,isPwd:!0,picture:null,picture_aux:null,file:null,file_:null,dialog_archivo:!1}},watch:{},computed:{},methods:{async save(){if(this.form.id){if(!this.$refs.first_name.validate()||!this.$refs.last_name.validate()||!this.$refs.identity_card.validate()||!this.$refs.entry_date.validate()||!this.$refs.email.validate()||!this.$refs.sex.validate()||!this.$refs.payment_type.validate()||!this.$refs.phone.validate())return this.loading=!1,this.$q.notify({message:"Campo requerido",color:"negative"});if(!/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(this.form.email))return this.loading=!1,this.$q.notify({message:"La dirección de correo no es valida",color:"negative"});try{this.picture_aux!==this.form.photo&&await this.savePhoto(),this.file_!==this.form.file&&await this.saveFile(),this.form.role="user",await this.$axios2.patch("usuarios/"+this.form.id,r()({},this.form)).then((e=>{this.loading=!1,this.$q.notify({message:"Usuario editado",color:"positive"}),this.$router.push("/usuarios")}))}catch(a){this.loading=!1,this.$q.notify({message:"Ups hubo un error",color:"negative"})}}else{if(!this.$refs.first_name.validate()||!this.$refs.last_name.validate()||!this.$refs.identity_card.validate()||!this.$refs.entry_date.validate()||!this.$refs.email.validate()||!this.$refs.sex.validate()||!this.$refs.payment_type.validate()||!this.$refs.phone.validate())return this.loading=!1,this.$q.notify({message:"Campo requerido",color:"negative"});if(!/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(this.form.email))return this.loading=!1,this.$q.notify({message:"La dirección de correo no es valida",color:"negative"});var e={where:{role:"user",email:this.form.email}},t=await this.$axios.get("usuarios?filter="+JSON.stringify(e));if(t.length)return void this.$q.dialog({title:"ALERTA!",message:'<span class="text-weight-bold text-grey-8">Se a encontrado en el sistema un usuario con la misma dirección de correo que intenta ingresar</span>',html:!0});try{this.form.password=this.generateP(),this.picture&&await this.savePhoto(),this.file&&await this.saveFile(),this.form.role="user",await this.$axios2.post("usuarios",r()({},this.form)).then((e=>{this.loading=!1,this.$q.notify({message:"Usuario guardado",color:"positive"}),this.$router.push("/usuarios")}))}catch(a){this.loading=!1,this.$q.notify({message:"Ups hubo un error",color:"negative"})}}},async getUser(e){this.$q.loading.show(),await this.$axios.get("usuarios/"+e,{filter:{role:"user"}}).then((async e=>{if(this.form=e,this.form.photo){const e=await Object(C["a"])(this.$env.fileUrl+this.form.photo);this.picture=e,this.picture_aux=e}if(this.form.file){const e=await Object(C["a"])(this.$env.fileUrl+this.form.file);this.file=e,this.file_=e}this.$q.loading.hide()})).catch((e=>{this.$q.loading.hide()}))},clearImg(){this.picture=null},async getRuta(e){this.file_=e,this.file=!0},async uploadFile(){this.$q.loading.show(),await this.$files("files/"+this.file_[0].name).put(this.file_[0]).then((async()=>{await this.$axios.post("usuarios/upload_file",{file:this.file_[0].name}).then((e=>{})).catch((e=>{this.$q.loading.hide(),this.$q.notify({message:"hubo un error",color:"negative"})}))})).catch((e=>{this.$q.loading.hide(),this.$q.notify({message:"hubo un error",color:"negative"})})),this.file=!1,this.file_=null,this.$q.loading.hide()},async savePhoto(){var e=this.picture.split("data:image/")[1].split(";")[0],t="photo-"+this.form.identity_card+"."+e,a=`files/${t}`,i=this.$base642file(this.picture,t);return await this.$files(a).put(i),this.form.photo=a,!0},async saveFile(){var e=this.picture.split("data:image/")[1].split(";")[0],t="documentacion-"+this.form.identity_card+"."+e,a=`files/${t}`,i=this.$base642file(this.file,t);return await this.$files(a).put(i),this.form.file=a,!0},generateP(){var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$";for(let i=1;i<=8;i++){var a=Math.floor(Math.random()*t.length+1);e+=t.charAt(a)}return e}},async mounted(){this.$route.params.id&&await this.getUser(this.$route.params.id)}},S=k,P=a("a370"),Q=a("27f9"),I=a("0016"),U=a("7cbe"),F=a("52ee"),j=a("ddd8"),z=a("e7a9"),D=Object(f["a"])(S,i,s,!1,null,null,null);t["default"]=D.exports;_()(D,"components",{QBtn:p["a"],QCard:g["a"],QCardSection:P["a"],QInput:Q["a"],QIcon:I["a"],QPopupProxy:U["a"],QDate:F["a"],QSelect:j["a"],QDialog:v["a"],QBtnGroup:z["a"]}),_()(D,"directives",{ClosePopup:q["a"]})},adb8:function(e,t,a){"use strict";a("b0b0")},b0b0:function(e,t,a){}}]);