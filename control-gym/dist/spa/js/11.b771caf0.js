(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{"879b":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"q-pa-xl"},[e.datos.length?a("q-table",{staticClass:"table",attrs:{dark:"",color:"white",data:e.datos,columns:e.columns,filter:e.filter,"row-key":"name"},scopedSlots:e._u([{key:"top-right",fn:function(){return[a("q-input",{attrs:{dark:"",borderless:"",dense:"",debounce:"300",placeholder:"Buscar"},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[a("q-icon",{attrs:{slot:"append",name:"search"},slot:"append"})],1)]},proxy:!0},{key:"body",fn:function(t){return[a("q-tr",{staticClass:"cursor-pointer",attrs:{props:t},on:{click:function(a){return e.open(t.row)}}},[a("q-td",{key:"nombre",attrs:{props:t}},[e._v("\n            "+e._s(t.row.nombre)+"\n          ")]),a("q-td",{key:"apellido",attrs:{props:t}},[e._v("\n            "+e._s(t.row.apellido)+"\n          ")]),a("q-td",{key:"cedula",attrs:{props:t}},[e._v("\n            "+e._s(t.row.cedula)+"\n          ")]),a("q-td",{key:"email",attrs:{props:t}},[e._v("\n            "+e._s(t.row.email)+"\n          ")])],1)]}}],null,!1,3555350070)}):e._e()],1),a("q-dialog",{on:{show:e.verific_mensualidad,hide:function(t){e.year=e.$moment().year(),e.month=Number(e.$moment().format("M"))}},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("q-card",{staticClass:"card",staticStyle:{width:"50%"}},[a("q-card-section",{staticClass:"text-center text-weight-bolder text-white"},[a("div",{staticClass:"text-h6"},[e._v("\n          "+e._s(e.form.nombre+" "+e.form.apellido)+"\n        ")]),a("div",{staticClass:"text-title"},[e._v("\n          "+e._s(e.form.cedula)+"\n        ")])]),a("q-card-section",{staticClass:"justify-center q-gutter-md"},[a("div",{staticClass:"q-pb-xs row justify-center q-gutter-md"},[a("div",[a("q-select",{ref:"year",staticStyle:{width:"200px"},attrs:{label:"Año",type:"number",options:e.years,rules:[function(e){return!!e||"campo requerido"}],color:"white",dark:"","map-options":"","emit-value":""},on:{input:e.verific_mensualidad},model:{value:e.year,callback:function(t){e.year=t},expression:"year"}})],1),a("div",[a("q-select",{ref:"month",staticStyle:{width:"200px"},attrs:{label:"Mes",options:[{label:"Enero",value:1},{label:"Febrero",value:2},{label:"Marzo",value:3},{label:"Abril",value:4},{label:"Mayo",value:5},{label:"Junio",value:6},{label:"Julio",value:7},{label:"Agosto",value:8},{label:"Septiembre",value:9},{label:"Octubre",value:10},{label:"Noviembre",value:11},{label:"Diciembre",value:12}],rules:[function(e){return!!e||"campo requerido"}],color:"white",dark:"","map-options":"","emit-value":""},on:{input:e.verific_mensualidad},model:{value:e.month,callback:function(t){e.month=t},expression:"month"}})],1),a("div",[a("q-input",{staticClass:"col-md-3 col-xs-12",staticStyle:{width:"200px"},attrs:{prefix:"$",label:"Monto del mes",color:"white",type:"number",dark:"",readonly:""},model:{value:e.form.amount,callback:function(t){e.$set(e.form,"amount",t)},expression:"form.amount"}})],1),a("div",[a("q-input",{staticClass:"col-md-3 col-xs-12",staticStyle:{width:"200px"},attrs:{label:"Tipo de pago",color:"white",dark:"",readonly:""},model:{value:e.form.payment_type,callback:function(t){e.$set(e.form,"payment_type",t)},expression:"form.payment_type"}})],1),a("div",[a("q-select",{ref:"payment_method",staticStyle:{width:"200px"},attrs:{label:"Metodo de pago",options:[{label:"Divisas",value:"divisa"},{label:"Transferencia/Pago Móvil",value:"transferencia"},{label:"Punto de venta",value:"Punto"}],rules:[function(e){return!!e||"campo requerido"}],color:"white",dark:"","map-options":"","emit-value":""},model:{value:e.form.payment_method,callback:function(t){e.$set(e.form,"payment_method",t)},expression:"form.payment_method"}})],1),"transferencia"==e.form.payment_method?a("div",[a("q-input",{ref:"num_ref",staticStyle:{width:"200px"},attrs:{rules:[function(e){return!!e||"campo requerido"}],label:"Nº Referencia",color:"white",dark:""},model:{value:e.form.num_ref,callback:function(t){e.$set(e.form,"num_ref",t)},expression:"form.num_ref"}})],1):e._e(),a("div",{staticClass:"column"},[a("q-checkbox",{attrs:{color:"grey-8",dark:"",label:"Exonerado"},model:{value:e.form.exonerated,callback:function(t){e.$set(e.form,"exonerated",t)},expression:"form.exonerated"}}),e.form.exonerated?a("q-input",{staticStyle:{width:"200px"},attrs:{dark:"",color:"white"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{attrs:{cover:"","transition-show":"scale","transition-hide":"scale"}},[a("q-date",{staticClass:"dialog ",attrs:{color:"grey-8",range:"",minimal:"",mask:"YYYY-MM-DD"},model:{value:e.form.exonerated_date,callback:function(t){e.$set(e.form,"exonerated_date",t)},expression:"form.exonerated_date"}},[a("div",{staticClass:"row items-center justify-end"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Cerrar",color:"white",flat:""}})],1)])],1)],1)]},proxy:!0}],null,!1,265922465),model:{value:e.desde_hasta,callback:function(t){e.desde_hasta=t},expression:"desde_hasta"}}):e._e()],1)]),a("q-card-actions",{attrs:{align:"center"}},[a("q-btn",{staticStyle:{width:"150px"},attrs:{label:"generar",outline:"",color:"white",disable:!e.verific_mensualidad_},on:{click:e.generar}})],1)],1)],1)],1)],1)},i=[],s=(a("4e82"),a("e6cf"),{data(){return{year:this.$moment().year(),month:Number(this.$moment().format("M")),form:{exonerated:!1},dialog:!1,filter:null,full_pay:!1,aja:!1,datos:[],columns:[{name:"nombre",required:!0,label:"Nombre",align:"left",field:e=>e.nombre,format:e=>`${e}`,sortable:!0},{name:"apellido",align:"left",label:"Apellido",field:"apellido",sortable:!0},{name:"cedula",align:"center",label:"Cedula",field:"cedula",sortable:!0},{name:"email",align:"center",label:"Correo",field:"email",sortable:!0}],verific_mensualidad_:!0,desde_hasta:null}},watch:{"form.exonerated_date"(e){this.desde_hasta=e?e.from+" hasta "+e.to:null,this.form.hasta=e?e.to:null}},computed:{years(){for(var e=[],t=this.$moment().year();t>=2010;t--)e.push({label:t,value:t});return e}},methods:{async get(){this.$q.loading.show(),await this.$axios2.post("pagos/get_users",{month:this.month,year:this.year}).then((e=>{this.datos=e.result,this.$q.loading.hide()})).catch((e=>{this.$q.loading.hide()}))},async get_user(){this.$q.loading.show(),await this.$axios2.post("pagos/get_users",{month:this.month,year:this.year}).then((e=>{if(e&&e.result.length){let t=e.result.find((e=>e.user_id==this.form.user_id));t&&(this.form=t)}this.$q.loading.hide()})).catch((e=>{this.$q.loading.hide()}))},async open(e){this.form=e,this.dialog=!0},async Pago_total(){this.$q.loading.show();var e=await this.verific_mensualidad();e||await this.$axios.post("pagos/automatico",{usuarios:this.datos,year:this.year,month:this.month,full_pay:this.full_pay,condominium:this.condominium}).then((async e=>{this.datos=e.result,this.$q.loading.hide()})).catch((e=>{this.$q.loading.hide(),this.$q.notify({message:"hubo un error",color:"negative"})}))},async generar(){if(this.$q.loading.show(),!this.$refs.payment_method.validate()||"transferencia"==this.form.payment_method&&!this.$refs.num_ref.validate())return this.$q.loading.hide(),this.$q.notify({message:"Campo requerido",color:"negative"});var e=await this.verific_pagos_generados();if(!e){var t=await this.verific_monto();t||await this.$axios.post("pagos/generar",{datos:this.form,year:this.year,month:Number(this.month)}).then((async e=>{this.$q.loading.hide(),this.$q.notify({message:"Pago generado exitosamente!",color:"positive"}),this.dialog=!1,await this.get()})).catch((e=>{this.$q.loading.hide(),this.$q.notify({message:"hubo un error",color:"negative"})}))}},async verific_pagos_generados(){var e=await this.$axios2.get("pagos",{filter:{usuario:this.form.user_id}});let t=e.length?e.sort()[e.length-1]:null;return!!(t&&this.$moment(t.hasta)>this.$moment(`${this.year}-${this.month}-${this.$moment().day()}`))&&(this.$q.dialog({title:"Atención",message:'<span class="text-weight-bold text-body2">Según el mes y año ya se han generados pagos. Si desa volver a generar por favor elimine el anterior</span>',html:!0,color:"red",dark:!0}).onOk((()=>{})),this.$q.loading.hide(),!0)},async verific_mensualidad(){var e=await this.$axios2.get("mensualidades",{filter:{year:this.year,month:this.month}});return e.length?(await this.get_user(),this.verific_mensualidad_=!0,!1):(this.$q.dialog({title:"Atención",message:'<span class="text-weight-bold text-body2">No hay mensualidad configurada según el mes y año escogido</span>',html:!0,color:"red",dark:!0}).onOk((()=>{})),this.verific_mensualidad_=!1,this.year=this.$moment().year(),this.month=Number(this.$moment().format("M")),this.$q.loading.hide(),!0)},async verific_monto(){var e=this.datos.some((e=>null==e.amount));return!!e&&(this.$q.loading.hide(),this.$q.notify({message:'Por favor asegurese que los usuarios no tengan el campo "Monto" vacío',color:"negative"}),!0)}},async mounted(){await this.get()}}),r=s,l=a("2877"),n=a("eaac"),d=a("27f9"),c=a("0016"),m=a("bd08"),u=a("db86"),h=a("24e8"),p=a("f09f"),f=a("a370"),g=a("ddd8"),y=a("8f8e"),v=a("7cbe"),b=a("52ee"),_=a("9c40"),q=a("4b7e"),w=a("7f67"),x=a("eebe"),$=a.n(x),k=Object(l["a"])(r,o,i,!1,null,null,null);t["default"]=k.exports;$()(k,"components",{QTable:n["a"],QInput:d["a"],QIcon:c["a"],QTr:m["a"],QTd:u["a"],QDialog:h["a"],QCard:p["a"],QCardSection:f["a"],QSelect:g["a"],QCheckbox:y["a"],QPopupProxy:v["a"],QDate:b["a"],QBtn:_["a"],QCardActions:q["a"]}),$()(k,"directives",{ClosePopup:w["a"]})}}]);