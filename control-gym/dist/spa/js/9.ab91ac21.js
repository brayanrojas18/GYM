(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"2adb":function(e,a,t){"use strict";t.r(a);var o=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("div",{staticClass:"q-pa-xl"},[t("div",{staticClass:"q-pb-md"},[t("q-btn",{attrs:{label:"Nueva Mensualidad",outline:"",color:"white",icon:"add",disable:"admin-general"!==e.user.role},on:{click:function(a){e.crear=!0}}})],1),t("q-table",{staticClass:"table",attrs:{title:"Mensualidades",data:e.data,columns:e.columns,filter:e.filter,"row-key":"name"},scopedSlots:e._u([{key:"top-right",fn:function(){return[t("q-input",{attrs:{dark:"",borderless:"",dense:"",debounce:"300",placeholder:"Buscar"},model:{value:e.filter,callback:function(a){e.filter=a},expression:"filter"}},[t("q-icon",{attrs:{slot:"append",name:"search"},slot:"append"})],1)]},proxy:!0},{key:"body",fn:function(a){return[t("q-tr",{attrs:{props:a}},[t("q-td",{key:"amount",attrs:{props:a}},[e._v(" "+e._s(a.row.amount)+"$ ")]),t("q-td",{key:"month",attrs:{props:a}},[e._v("\n            "+e._s(a.row.month)+"\n          ")]),t("q-td",{key:"year",attrs:{props:a}},[e._v("\n            "+e._s(a.row.year)+"\n          ")]),t("q-td",{key:"actions",attrs:{props:a}},[t("q-btn",{attrs:{color:"white",outline:"",label:"Editar",size:"sm",disable:"admin-general"!==e.user.role},on:{click:function(t){return e.editar(a.row)}}},[t("q-tooltip",{attrs:{"content-class":"color-orange"}},[e._v("Editar")])],1),t("q-btn",{attrs:{color:"white",outline:"",label:"Ver",size:"sm",disable:"admin-general"!==e.user.role},on:{click:function(t){return e.ver(a.row)}}},[t("q-tooltip",{attrs:{"content-class":"color-orange"}},[e._v("Ver")])],1),t("q-btn",{attrs:{color:"white",outline:"",label:"Eliminar",size:"sm",disable:"admin-general"!==e.user.role},on:{click:function(t){return e.eliminar(a.row)}}},[t("q-tooltip",{attrs:{"content-class":"color-orange"}},[e._v("Eliminar")])],1)],1)],1)]}}])})],1),t("q-dialog",{attrs:{persistent:""},model:{value:e.crear,callback:function(a){e.crear=a},expression:"crear"}},[t("q-card",{staticClass:"dialog",staticStyle:{width:"20%"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-ml-xs q-mt-xs",attrs:{flat:"",round:"",icon:"reply",color:"white"},on:{click:function(a){e.form={},e.show=!1}}}),t("q-card-section",{staticClass:"items-center"},[t("q-select",{ref:"year",attrs:{readonly:e.show,label:"Año",type:"number",options:e.years,rules:[function(e){return!!e||"campo requerido"}],color:"white",dark:"","map-options":"","emit-value":""},model:{value:e.form.year,callback:function(a){e.$set(e.form,"year",a)},expression:"form.year"}}),t("q-select",{ref:"month",attrs:{readonly:e.show,label:"Mes",options:[{label:"Enero",value:1},{label:"Febrero",value:2},{label:"Marzo",value:3},{label:"Abril",value:4},{label:"Mayo",value:5},{label:"Junio",value:6},{label:"Julio",value:7},{label:"Agosto",value:8},{label:"Septiembre",value:9},{label:"Octubre",value:10},{label:"Noviembre",value:11},{label:"Diciembre",value:12}],rules:[function(e){return!!e||"campo requerido"}],color:"white",dark:"","map-options":"","emit-value":""},model:{value:e.form.month,callback:function(a){e.$set(e.form,"month",a)},expression:"form.month"}}),t("q-input",{ref:"amount",attrs:{readonly:e.show,prefix:"$",label:"Mensualidad del mes",rules:[function(e){return!!e||"campo requerido"}],color:"white",type:"number",dark:""},model:{value:e.form.amount,callback:function(a){e.$set(e.form,"amount",a)},expression:"form.amount"}})],1),e.show?e._e():t("q-card-actions",[t("q-btn",{staticClass:"full-width",attrs:{outline:"",label:"Guardar",color:"white"},on:{click:e.create}})],1)],1)],1)],1)},r=[],i=(t("4e82"),t("e6cf"),t("ded3")),s=t.n(i),n=t("2f62"),l={data(){return{crear:!1,show:!1,filter:null,form:{year:this.$moment().year(),month:Number(this.$moment().format("MM"))},data:[],columns:[{name:"amount",required:!0,label:"Monto",align:"center",field:e=>e.amount,format:e=>`${e}`,sortable:!0},{name:"month",align:"center",label:"Mes",field:"month",sortable:!0},{name:"year",align:"center",label:"Año",field:"year",sortable:!0},{name:"actions",align:"center",label:"Acciones",sortable:!0}]}},watch:{},computed:s()(s()({},Object(n["d"])("example",["user"])),{},{years(){for(var e=[],a=this.$moment().year();a>=2e3;a--)e.push({label:a,value:a});return e}}),methods:{async get(){this.$q.loading.show(),await this.$axios2.get("mensualidades").then((e=>{this.data=e,this.data.sort((function(e,a){return e.year-a.year})),this.$q.loading.hide()})).catch((e=>{this.$q.loading.hide()}))},async create(){if(this.$q.loading.show(),!this.$refs.year.validate()||!this.$refs.month.validate()||!this.$refs.amount.validate())return this.$q.loading.hide(),this.$q.notify({message:"Campo requerido",color:"negative"});var e,a=this.data.find((e=>e.year==this.form.year&&e.month==this.form.month));if(!this.form.id&&a)return this.$q.loading.hide(),this.$q.notify({message:'Ya se ha guardado una mensualidad segun el "Año" y el "Mes" ',color:"orange"});e=this.form.id?this.$axios2.put("mensualidades/"+this.form.id,this.form):this.$axios2.post("mensualidades",this.form),await e.then((async e=>{await this.get(),this.crear=!1,this.form={},this.$q.notify({message:"Mensualidad "+(this.form.id?"Modificada":"Guardada"),color:"positive"}),this.$q.loading.hide()})).catch((e=>{this.$q.loading.hide(),this.$q.notify({message:"Ups hubo un error",color:"negative"})}))},async editar(e){var a=await this.pagos_generados(e);a||await this.$axios2.get("mensualidades/"+e.id).then((e=>{this.form=e,this.crear=!0}))},async ver(e){this.form=e,this.crear=!0,this.show=!0},async eliminar(e){var a=await this.pagos_generados(e);a||this.$q.dialog({title:"Eliminar",message:"¿Segúro que quiere eliminar esta mensualidad?",cancel:"Cancelar",persistent:!0}).onOk((async()=>{await this.$axios2.delete("mensualidades/"+e.id).then((async e=>{this.$q.notify({message:"Mensualidad Eliminada",color:"positive"}),await this.get()})).catch((e=>{this.loading=!1,this.$q.notify("Ups hubo un error")}))})).onCancel((()=>{}))},async pagos_generados(e){var a=await this.$axios2.get("pagos",{filter:{year:e.year,month:e.month}});return!!a.length&&(this.$q.dialog({title:"Atención",message:'<span class="text-weight-bold text-body2">Según el mes y año ya se han generados pagos, por lo tanto no se puede editar ni eliminar esta mensualidad. Si desea editar o eliminar elimine el pago realizado</span>',html:!0}).onOk((()=>{})),!0)}},async mounted(){await this.get()}},d=l,c=t("2877"),u=t("9c40"),m=t("eaac"),h=t("27f9"),p=t("0016"),f=t("bd08"),b=t("db86"),g=t("05c0"),y=t("24e8"),q=t("f09f"),v=t("a370"),w=t("ddd8"),$=t("4b7e"),k=t("7f67"),x=t("eebe"),_=t.n(x),C=Object(c["a"])(d,o,r,!1,null,null,null);a["default"]=C.exports;_()(C,"components",{QBtn:u["a"],QTable:m["a"],QInput:h["a"],QIcon:p["a"],QTr:f["a"],QTd:b["a"],QTooltip:g["a"],QDialog:y["a"],QCard:q["a"],QCardSection:v["a"],QSelect:w["a"],QCardActions:$["a"]}),_()(C,"directives",{ClosePopup:k["a"]})}}]);